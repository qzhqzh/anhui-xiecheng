star5 = [48474278,448747,447961,425943,68529299,3999801,6928736,457522,5674762,646712,5702138,22457188,9452501,7825692,1314956,2850277,8807640,416237,68088783,425776,447197,65392279,660186,1633341,51050097,419341,425209,419896,607468,476077,64182675,456860,474657,450942,65133563,430486,419339,654945,56599238,1293666,2204223,20264385,18412457,1585237,28356663,5677106,23856373,1487247,61658912,436600,1287612,430328,1430498,1701813,52673172,481810,6839077,5683212,26450971,688665,703367,441322,480225,430533,19611727,419898,21900347,21812461,1081257,68492251,479319,437569,436601,2311526,643649,2301134,1554752,699989,1225627,437549,13947169,52855560,6313347,801366,660261,455080,416261,974773,603138,6077874,511481]
star4 = [54449035,68091922,67053071,80888495,1387001,6814953,81294344,64226088,70657744,71649215,1648800,31405762,10603641,80127808,14154696,31484057,63350096,67665905,83709154,7104971,54625950,21133091,6264194,67165443,1613987,448871,72984341,71512556,54628056,26430394,19438841,22680419,18555025,65110039,1633188,1018509,63279541,39873001,28725110,14815888,23650363,67324234,638416,24767361,24274337,80398371,430494,512218,17472402,15898520,61452153,59409312,443894,60904295,5702767,68008528,55236609,72243352,38417192,72130096,77209659,1080709,60169006,1008526,49377028,1632958,24410215,6748235,15533084,48474454,48539836,717396,426691,54426528,980690,73719781,2248220,1648887,68614093,66686926,7265845,48304981,72598871,1701851,57674326,13324813,1632944,15911950,38942011,2082630,68100924,426694,56466155,72244427,22420482,1440456,447376,28127051,41651265,47626408,71406713,23865199,85235726,2699739,71576110,81306954,1392283,85542169,845232,67226091,1005938,33389687,2104746,1520365,17962941,47776544,82604289,6469477,1603528,34052411,5292750,28475725,80908623,6118718,1600836,1593190,22685647,23649906,5767961,9547619,1583732,5973195,68072292,5723397,69313355,16011851,19853356,48562862,1701885,1500138,8541897,28678574,775411,825419,5462819,1441070,83097914,1633110,71566598,1003273,1480035,91000323,1006454,1634745,23921485,1462237,6443458,13825487,34563470,994005,70428236,2298691,1642263,458326,17527090,82650899,61670745,669335,69313362,434077,2005959,2299428,2585383,749195,16068779,5889260,83644078,77239680,61821599,70786789,708186,80797310,63350923,56795806,66963895,54852862,76116741,26547476,33635361,757955,80437098,22419200,437561,1632995,1633502,11216054,46807218,78158258,34054445,81422661,1486761,476135,8125585,2013610,533045,513804,44465402,55468961,70988710,3640336,18443764,8900210,18030421,8039428,426681,22774537,68080611,72890069,9110773,18500028,23481069,10786063,476153,8179189,480822,59412469,85467109,45537033,8357780,1016873,416249,35599745,668653,979382,70797371,50346425,68678193,432308,416232,450929,419337,67317942,29973172,6825546,61729732,5159157,450925,2084073,80814999,36247707,1813932,17297449,60978607,8291186,661199,85467080,82814282,47623234,6211700,1097228,2298363,80525871,5903028,35083583,89250912,2360569,87273931,480229,25211874,5296733]

#
# print(len(star5))
# print(len(star4))

import requests
import json, os


def dl_json(lst, sub_dir):
    for i in lst:
        cmd = f"""
        curl --location --request POST 'https://m.ctrip.com/restapi/soa2/21881/json/hotelStaticInfo' \
        --header 'Content-Type: application/json' \
        --data-raw '{{
            "masterHotelId": {i},
            "isBusiness": false,
            "feature": [],
            "cityCode": 23,
            "checkIn": "2022-04-01",
            "checkOut": "2022-04-02",
            "head": {{
                "Locale": "zh-CN",
                "Currency": "CNY",
                "Device": "PC",
                "UserIP": "117.152.146.132",
                "Group": "",
                "ReferenceID": "",
                "UserRegion": "CN",
                "AID": "4902",
                "SID": "130727",
                "Ticket": "",
                "UID": "",
                "IsQuickBooking": "",
                "ClientID": "09031087215639451120",
                "OUID": "",
                "TimeZone": "8",
                "P": "87580272627",
                "PageID": "102003",
                "Version": "",
                "HotelExtension": {{
                    "WebpSupport": true,
                    "group": "CTRIP",
                    "Qid": "607409051551",
                    "hasAidInUrl": false
                }},
                "Frontend": {{
                    "vid": "1648817536451.74evn",
                    "sessionID": 3,
                    "pvid": 68
                }}
            }},
            "ServerData": ""
        }}' > r/{sub_dir}/{i}.json
        """
        os.system(cmd)

# dl_json(star5, '5')
# dl_json(star4, '4')




with open('酒店(携程).tsv', 'w')as fhO:
    fhO.write(f'星级\t名字\t介绍\t其他\t网址\t电话\n')
    dd = 'r/5'
    for f in os.listdir(dd):
        x = os.path.join(dd, f)
        with open(x)as fh:
            j = json.load(fh)
            a = j['Response']['hotelInfo']['basic']['name']
            b = j['Response']['hotelInfo']['basic']['description'].replace('\n', ' ').replace('\t', ' ')
            c = j['Response']['hotelInfo']['basic']['label'][:-1]
            d = j['Response']['hotelInfo']['basic']['label'][-1]
            fhO.write(f'5\t{a}\t{b}\t{c}\thttps://hotels.ctrip.com/hotels/detail/?hotelId={f.split(".json")[0]}\t{d}\n')
    dd = 'r/4'
    for f in os.listdir(dd):
        x = os.path.join(dd, f)
        with open(x) as fh:
            j = json.load(fh)
            a = j['Response']['hotelInfo']['basic'].get('name', f)
            b = j['Response']['hotelInfo']['basic'].get('description', '-').replace('\n', ' ').replace('\t', ' ')
            c = j['Response']['hotelInfo']['basic'].get('label', ['-'])[:-1]
            d = j['Response']['hotelInfo']['basic'].get('label', ['-'])[-1]
            fhO.write(f'4\t{a}\t{b}\t{c}\thttps://hotels.ctrip.com/hotels/detail/?hotelId={f.split(".json")[0]}\t{d}\n')














# def fetchHotel():
#
#     url = "https://m.ctrip.com/restapi/soa2/21881/json/hotelStaticInfo"
#     headers = {
#         'Content-Type': 'application/json'
#     }
#
#     formData = {
#     "masterHotelId": 6077874,
#     "isBusiness": False,
#     "feature": [],
#     "cityCode": 23,
#     "checkIn": "2022-04-01",
#     "checkOut": "2022-04-02",
#     "head": {
#         "Locale": "zh-CN",
#         "Currency": "CNY",
#         "Device": "PC",
#         "UserIP": "117.152.146.132",
#         "Group": "",
#         "ReferenceID": "",
#         "UserRegion": "CN",
#         "AID": "4902",
#         "SID": "130727",
#         "Ticket": "",
#         "UID": "",
#         "IsQuickBooking": "",
#         "ClientID": "09031087215639451120",
#         "OUID": "",
#         "TimeZone": "8",
#         "P": "87580272627",
#         "PageID": "102003",
#         "Version": "",
#         "HotelExtension": {
#             "WebpSupport": True,
#             "group": "CTRIP",
#             "Qid": "607409051551",
#             "hasAidInUrl": False
#         },
#         "Frontend": {
#             "vid": "1648817536451.74evn",
#             "sessionID": 3,
#             "pvid": 68
#         }
#     },
#     "ServerData": ""
# }

    # # 发起网络请求
    # r = requests.post(url, data=formData, headers=headers)
    # r.raise_for_status()
    # r.encoding = r.apparent_encoding
    #
    # # 打印 r.text 来看看是否获取到了酒店数据
    # print(r.text)
    # print(r.__dict__)
    # print(r.text)
    #
    # # 解析 json 文件，提取酒店数据
    # json_data = json.loads(r.text)
    # print(json_data)
    #
    # with open('r/48474278.json', 'w')as fh:
    #     fh.write(r.text)
    #
    #
    # hotelList = []
    # # for item in json_data:
    #     # hotelId = item['id']
    #     # hotelList.append(hotelId)
    #     # print(item['name'], hotelId)
    #
    # return hotelList

# fetchHotel()